---
title: "`r params$image_name`"
date: "`r format(Sys.time(), '%Y-%m-%d %H:%M:%S %Z')`"
output:
  github_document:
    html_preview: false
    df_print: kable
params:
  image_name: ""
  inspect_file: ""
  apt_file: ""
  r_file: ""
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, message = FALSE)
```

## Image info

```{r}
jsonlite::read_json(params$inspect_file) |>
  tibble::enframe() |>
  dplyr::transmute(
    ImageID = purrr::map_chr(value, "Id"),
    RepoTags = purrr::map(value, "RepoTags"),
    RepoDigests = purrr::map_chr(value, list("RepoDigests", 1)),
    CreatedTime = purrr::map_chr(value, "Created"),
    Env = purrr::map(value, c("ContainerConfig", "Env"))
  ) |>
  dplyr::mutate(
    ImageID = paste0("`", ImageID, "`"),
    RepoTags = paste0("`", paste(unlist(RepoTags), collapse = "`, `"), "`"),
    RepoDigests = paste0("`", RepoDigests, "`"),
    Env = paste(unlist(Env), collapse = ", ")
  ) |>
  tidyr::pivot_longer(cols = tidyselect::everything())
```

## apt packages

```{r}
readr::read_tsv(params$apt_file, col_names = FALSE) |>
  dplyr::transmute(
    package = X1,
    version = X2
  )
```

## R packages

```{r}
readr::read_table(params$r_file, skip = 1, col_names = FALSE) |>
  dplyr::transmute(
    package = X1,
    version = X2
  )
```
